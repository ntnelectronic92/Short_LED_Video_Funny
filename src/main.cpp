#include <Arduino.h>
#include "LedControl.h"
#define volumeControlPin  A3
int volumeValue  = 0;
int volumeValueFilter = 0;

#define MAX_DEVICES 1

#define CLK_PIN   13
#define DATA_PIN  11
#define CS_PIN    10

byte array[][8]=
{

 { 0x80, 0xC3, 0x22, 0x1F, 0x1E, 0x22, 0xC4, 0x84, },
 { 0x80, 0xC6, 0x22, 0x1E, 0x1F, 0x22, 0xC3, 0x81, },
 { 0x80, 0xC6, 0x22, 0x1E, 0x1F, 0x22, 0xC6, 0x84, },
 { 0x80, 0x86, 0x82, 0xFE, 0x1F, 0x22, 0xC6, 0x84, },
 { 0x80, 0x86, 0x82, 0xFE, 0xFF, 0x82, 0x86, 0x84, },
 { 0x80, 0x43, 0x22, 0x1E, 0xFF, 0x82, 0x86, 0x84, },
 { 0x80, 0xC3, 0x22, 0x1F, 0x3E, 0x22, 0xC3, 0x81, },
 { 0x80, 0xC3, 0x22, 0x1E, 0x3F, 0x22, 0xC3, 0x81, },
 { 0x80, 0x86, 0xE2, 0x1E, 0x3F, 0x22, 0xC3, 0x81, },
 { 0x80, 0x86, 0xE2, 0x1F, 0x7E, 0x42, 0x83, 0x81, },
 { 0x80, 0x83, 0xE2, 0x1E, 0x1F, 0xE2, 0x83, 0x81, },
 { 0x81, 0x83, 0x82, 0xFE, 0xFF, 0x82, 0x83, 0x81, },
 { 0x84, 0x86, 0x82, 0xFF, 0xFE, 0x82, 0x83, 0x81, },
 { 0x80, 0x80, 0x9E, 0xFF, 0xFE, 0x82, 0x82, 0x82, },
 { 0x80, 0x80, 0x9E, 0xFE, 0xFF, 0x9E, 0x80, 0x80, },
};

#define SIZE_MAX(X) sizeof(X)/sizeof(X[0])
LedControl lc = LedControl(DATA_PIN, CLK_PIN, CS_PIN, 1);  // Create a LedControl object
/// INIT AREA////////////
void initSerial()
{
  Serial.begin(115200);
  Serial.print("MAX VOLUME = ");
  int valueMaxVolume = SIZE_MAX(array);
  Serial.print(valueMaxVolume);
   Serial.println();
  
}
void initMatrix7219()
{
  lc.shutdown(0, false);  // Wake up the MAX7219
  lc.setIntensity(0, 8);  // Set the brightness (0-15)
  lc.clearDisplay(0);     // Clear the displa
}
void displayIcon(byte icon[]) {
  for (int row = 0; row < 8; row++) {
    lc.setRow(0, row, icon[row]);
  }
}

////HANDLE AREA////////////
void volumeHandle()
{
  volumeValue = analogRead(volumeControlPin);
  volumeValueFilter = map(volumeValue,0,1024,0,SIZE_MAX(array));

}
void matrixHandle()
{
  static int preVolumeValue = 1000;
  if(preVolumeValue!= volumeValueFilter)
  {
    Serial.print("Value of volumeValueFilter =");
    Serial.print(volumeValueFilter);
    Serial.println();
    lc.clearDisplay(0);
    displayIcon(array[volumeValueFilter]);
    preVolumeValue = volumeValueFilter;
  }
}
void setup() {
  initSerial();
  initMatrix7219();
}

void loop() 
{
  volumeHandle();
  matrixHandle();
}
